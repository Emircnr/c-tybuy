<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Yuvarlak Baloncuk Çarpma Oyunu</title>
  <style>
    body {
      background: #161a24;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin-top: 32px;
      margin-bottom: 8px;
      letter-spacing: 1px;
    }
    #info {
      margin-bottom: 18px;
      font-size: 1.12em;
      letter-spacing: .3px;
    }
    #startBtn {
      padding: 15px 34px;
      font-size: 18px;
      border-radius: 11px;
      border: none;
      background: #5a7cff;
      color: white;
      font-weight: bold;
      margin-bottom: 16px;
      cursor: pointer;
      box-shadow: 0 4px 14px #0004;
      transition: background .18s, box-shadow .18s;
    }
    #startBtn:hover {
      background: #2b336e;
      box-shadow: 0 2px 6px #0006;
    }
    #arena {
      width: 600px;
      height: 600px;
      background: #23273a;
      border: 6px solid #6fc5ff;
      border-radius: 50%;
      margin-bottom: 22px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 24px #0007;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .bubble {
      position: absolute;
      width: 22px;
      height: 22px;
      background: radial-gradient(circle at 65% 35%, #ffd166 60%, #ff835e 100%);
      border-radius: 50%;
      border: 2px solid #fff7;
      box-shadow: 0 2px 10px #0008;
      will-change: transform;
      transition: box-shadow .08s;
    }
    #counter {
      margin-bottom: 10px;
      font-size: 1.12em;
    }
  </style>
</head>
<body>
  <h1>Yuvarlak Baloncuk Çarpma Oyunu</h1>
  <div id="info">Başlat'a basınca, baloncuklar kenara çarptıkça 2'ye katlanır.<br>100 saniye boyunca devam eder. Üst limit: 20.000 baloncuk!</div>
  <div id="counter">Baloncuk: <span id="bubbleCount">0</span></div>
  <button id="startBtn">Başlat</button>
  <div id="arena"></div>

  <script>
    // Ayarlar
    const ARENA_SIZE = 600;
    const ARENA_RADIUS = ARENA_SIZE / 2;
    const BUBBLE_SIZE = 22;
    const BUBBLE_RADIUS = BUBBLE_SIZE / 2;
    const GAME_DURATION = 100 * 1000; // 100 saniye
    const MAX_BUBBLES = 20000;

    const arena = document.getElementById('arena');
    const startBtn = document.getElementById('startBtn');
    const counter = document.getElementById('bubbleCount');
    let bubbles = [];
    let running = false;
    let animationId = null;
    let gameTimeout = null;

    function updateCounter() {
      counter.textContent = bubbles.length;
    }

    // Baloncuk oluştur
    function createBubble(x, y, dx, dy) {
      const el = document.createElement('div');
      el.className = 'bubble';
      el.style.left = (x - BUBBLE_RADIUS) + 'px';
      el.style.top = (y - BUBBLE_RADIUS) + 'px';
      arena.appendChild(el);

      return { el, x, y, dx, dy };
    }

    // Baloncukları temizle
    function clearBubbles() {
      for (let b of bubbles) {
        b.el.remove();
      }
      bubbles = [];
      updateCounter();
    }

    // Çemberin kenarına çarpma kontrolü
    function isHittingCircleEdge(bubble) {
      // Arena merkezi
      const cx = ARENA_RADIUS;
      const cy = ARENA_RADIUS;
      // Baloncuğun merkezi
      const bx = bubble.x;
      const by = bubble.y;
      // Merkezden uzaklık
      const dist = Math.hypot(bx - cx, by - cy);
      // Eğer baloncuğun dış kenarı daire sınırından dışarı çıktıysa
      return (dist + BUBBLE_RADIUS) >= ARENA_RADIUS;
    }

    // Baloncuğun kenardan nasıl sekeceğini hesapla
    function bounceOffCircle(bubble) {
      // Merkez ile balon merkezi vektörü
      const cx = ARENA_RADIUS;
      const cy = ARENA_RADIUS;
      const vx = bubble.x - cx;
      const vy = bubble.y - cy;
      // Balon çemberin kenarına çarptıysa
      // Hareket vektörünü çemberin teğetine göre yansıt
      // Normali hesapla
      const norm = Math.hypot(vx, vy);
      const nx = vx / norm;
      const ny = vy / norm;
      // Hareket vektörü
      const dot = bubble.dx * nx + bubble.dy * ny;
      // Yansıt
      bubble.dx = bubble.dx - 2 * dot * nx;
      bubble.dy = bubble.dy - 2 * dot * ny;

      // Küçük bir rasgelelik
      const angleNoise = (Math.random()-0.5) * 0.6;
      const speed = Math.hypot(bubble.dx, bubble.dy);
      const angle = Math.atan2(bubble.dy, bubble.dx) + angleNoise;
      bubble.dx = Math.cos(angle) * speed;
      bubble.dy = Math.sin(angle) * speed;
    }

    // Oyunu başlat
    startBtn.onclick = () => {
      startBtn.disabled = true;
      startBtn.textContent = "Oyun Başladı...";
      clearBubbles();
      running = true;

      // İlk baloncuğu merkezde başlat, rastgele bir yön
      const angle = Math.random() * Math.PI * 2;
      const speed = 3.4;
      const dx = Math.cos(angle) * speed;
      const dy = Math.sin(angle) * speed;
      const startBubble = createBubble(ARENA_RADIUS, ARENA_RADIUS, dx, dy);
      bubbles.push(startBubble);
      updateCounter();

      animate();

      gameTimeout = setTimeout(() => {
        running = false;
        cancelAnimationFrame(animationId);
        startBtn.disabled = false;
        startBtn.textContent = "Yeniden Başlat";
      }, GAME_DURATION);
    };

    // Animasyon döngüsü
    function animate() {
      let newBubbles = [];

      for (let b of bubbles) {
        b.x += b.dx;
        b.y += b.dy;

        let hit = false;
        if (isHittingCircleEdge(b)) {
          bounceOffCircle(b);
          hit = true;
        }

        // DOM güncelle
        b.el.style.left = (b.x - BUBBLE_RADIUS) + 'px';
        b.el.style.top = (b.y - BUBBLE_RADIUS) + 'px';

        if (hit) {
          // Çarpışınca iki yeni baloncuk üret (her biri rastgele farklı yön)
          for (let i = 0; i < 2; i++) {
            const angle = Math.random() * Math.PI * 2;
            const speed = 2.6 + Math.random() * 2.8;
            const dx = Math.cos(angle) * speed;
            const dy = Math.sin(angle) * speed;
            // Kenara çok yakın olduğundan çemberin içine biraz it
            const norm = Math.hypot(b.x - ARENA_RADIUS, b.y - ARENA_RADIUS);
            const pullBackRatio = ((ARENA_RADIUS - BUBBLE_RADIUS - 2) / norm);
            const newX = ARENA_RADIUS + (b.x - ARENA_RADIUS) * pullBackRatio;
            const newY = ARENA_RADIUS + (b.y - ARENA_RADIUS) * pullBackRatio;
            const clone = createBubble(newX, newY, dx, dy);
            newBubbles.push(clone);
          }
          // Eskiyi sil (DOM)
          b.el.remove();
        } else {
          newBubbles.push(b);
        }
      }

      bubbles = newBubbles;
      updateCounter();

      // Baloncuk limiti kontrolü
      if (bubbles.length > MAX_BUBBLES) {
        running = false;
        alert(`Baloncuk limiti (${MAX_BUBBLES}) aşıldı! Oyun otomatik durdu.`);
        cancelAnimationFrame(animationId);
        clearTimeout(gameTimeout);
        startBtn.disabled = false;
        startBtn.textContent = "Yeniden Başlat";
        return;
      }

      if (running) {
        animationId = requestAnimationFrame(animate);
      }
    }
  </script>
</body>
</html>
