<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Ülke -> Şehir Bazlı Harita Örneği</title>
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-sA+rl8u/68Hl1C/2iYZp+HtKxFQ+a6BTukZ/jmFfL3g="
    crossorigin=""
  />
  <style>
    /* Sayfa ve Harita Temel Stil */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    .back-button {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 9999;
      background: #fff;
      color: #333;
      border: 1px solid #aaa;
      border-radius: 5px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 14px;
      display: none; /* Başlangıçta gizli, sadece şehir haritasında görünür */
    }
  </style>
  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-sA+rl8u/68Hl1C/2iYZp+HtKxFQ+a6BTukZ/jmFfL3g="
    crossorigin=""
  ></script>
</head>
<body>
  <!-- Geri butonu -->
  <button id="backButton" class="back-button">Geri (Dünya'ya Dön)</button>
  <!-- Harita konteyneri -->
  <div id="map"></div>

  <script>
    // --- 1) Harita Başlat ---
    let map = L.map("map").setView([20, 0], 2);

    // Tile Layer (Arka Plan)
    L.tileLayer(
      "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", 
      {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
      }
    ).addTo(map);

    // --- 2) Dünya Haritası (Ülkeler) ---
    let worldLayer = null;  // Tüm ülkelerin bulunduğu katman
    // Ülkelerin GeoJSON linki (johan repo)
    const worldGeoJsonUrl = "https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json";

    // --- 3) Türkiye İlleri (Örnek "şehir" verisi) ---
    let turkeyCityLayer = null;  // Türkiye illeri katmanı
    // Türkiye illeri GeoJSON
    const turkeyGeoJsonUrl = "https://raw.githubusercontent.com/funwithtris/tr_geodata/master/geojson/il.geojson";

    // Geri Dön Butonu
    const backButton = document.getElementById("backButton");
    backButton.addEventListener("click", () => {
      // Türkiye illeri (şehirler) katmanını haritadan kaldıralım
      if (turkeyCityLayer) {
        map.removeLayer(turkeyCityLayer);
      }
      // Dünya katmanını tekrar ekle
      if (worldLayer) {
        worldLayer.addTo(map);
      }
      // Butonu tekrar gizle
      backButton.style.display = "none";
      // Haritayı tekrar uzaklaştır (world scale)
      map.setView([20, 0], 2);
    });

    // --- 4) Ülke Katmanını Yükle ---
    fetch(worldGeoJsonUrl)
      .then(response => response.json())
      .then(geoData => {
        worldLayer = L.geoJson(geoData, {
          style: feature => ({
            color: "#555",
            weight: 1,
            fillColor: "#ccc",
            fillOpacity: 0.7
          }),
          onEachFeature: (feature, layer) => {
            // Her ülkeye tıklandığında
            layer.on("click", () => {
              const countryName = feature.properties.name || "Bilinmeyen";
              console.log("Tıklanan Ülke:", countryName);
              
              // Örnek olarak sadece "Turkey" (Türkiye) tıklanınca şehir katmanı gösteriyoruz
              if (countryName === "Turkey") {
                // 1) Dünya katmanını haritadan kaldır
                worldLayer.removeFrom(map);

                // 2) Türkiye illerini yükle ve haritaya ekle
                loadTurkeyCities();

                // 3) Geri butonunu göster
                backButton.style.display = "block";

                // 4) Yakınlaşma (optional)
                map.setView([39.0, 35.0], 5); // Türkiye merkezine yakın bir zoom
              } else {
                alert("Şimdilik sadece Türkiye örneği hazırlanmıştır.\n" + countryName + " tıklandı.");
              }
            });

            // Tooltip (ülke ismi)
            layer.bindTooltip(feature.properties.name || "Ülke", {
              permanent: false,
              direction: "center",
              className: "leaflet-tooltip"
            });
          }
        }).addTo(map);
      })
      .catch(err => console.error("Dünya verisi yüklenemedi:", err));

    // --- 5) Türkiye İlleri Katmanını Yükleyen Fonksiyon ---
    function loadTurkeyCities() {
      // Daha önce yüklenmişse tekrar fetch etmeye gerek yok
      if (turkeyCityLayer) {
        turkeyCityLayer.addTo(map);
        return;
      }

      fetch(turkeyGeoJsonUrl)
        .then(resp => resp.json())
        .then(turkeyData => {
          // Örnek: "turkeyData" verisinde iller "properties.NAME_1" ya da benzeri alanlarda olabilir
          turkeyCityLayer = L.geoJson(turkeyData, {
            style: feature => ({
              color: "#000",
              weight: 1,
              fillColor: "#64ffda",
              fillOpacity: 0.5
            }),
            onEachFeature: (feature, layer) => {
              const cityName = feature.properties.NAME_1 || "İl Adı Yok";
              layer.on("click", () => {
                alert("Şehir tıklandı: " + cityName);
              });
              layer.bindTooltip(cityName, {
                permanent: false,
                direction: "center",
                className: "leaflet-tooltip"
              });
            }
          }).addTo(map);
        })
        .catch(err => console.error("Türkiye şehir verisi yüklenemedi:", err));
    }
  </script>
</body>
</html>
