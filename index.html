
      "linear-gradient(135deg,#FFD166 60%,#FC7E5E 100%)",
      "linear-gradient(135deg,#7DE2FC 60%,#B9B6E5 100%)",
      "linear-gradient(135deg,#8AFFA7 60%,#00C9A7 100%)",
      "linear-gradient(135deg,#FFD6E0 60%,#FFB5C2 100%)",
      "linear-gradient(135deg,#FFF689 60%,#F9B53D 100%)"
    ];

    const arena = document.getElementById('arena');
    const startBtn = document.getElementById('startBtn');
    const counter = document.getElementById('bubbleCount');
    let bubbles = [];
    let running = false;
    let animationId = null;
    let gameTimeout = null;

    function updateCounter() {
      counter.textContent = bubbles.length;
    }

    // Baloncuk oluştur
    function createBubble(x, y, dx, dy, colorIndex = null) {
      const el = document.createElement('div');
      el.className = 'bubble';
      // Renk seç
      let idx = colorIndex !== null ? colorIndex : Math.floor(Math.random()*COLORS.length);
      el.style.background = COLORS[idx];
      el.dataset.colorIndex = idx;
      el.style.left = (x - BUBBLE_RADIUS) + 'px';
      el.style.top = (y - BUBBLE_RADIUS) + 'px';
      arena.appendChild(el);

      return { el, x, y, dx, dy, colorIndex: idx };
    }

    // Baloncukları temizle
    function clearBubbles() {
      for (let b of bubbles) {
        b.el.remove();
      }
      bubbles = [];
      updateCounter();
    }

    // Çemberin kenarına çarpma kontrolü
    function isHittingCircleEdge(bubble) {
      const cx = ARENA_RADIUS;
      const cy = ARENA_RADIUS;
      const bx = bubble.x;
      const by = bubble.y;
      const dist = Math.hypot(bx - cx, by - cy);
      return (dist + BUBBLE_RADIUS) >= ARENA_RADIUS;
    }

    // Baloncuğun kenardan nasıl sekeceğini hesapla
    function bounceOffCircle(bubble) {
      const cx = ARENA_RADIUS;
      const cy = ARENA_RADIUS;
      const vx = bubble.x - cx;
      const vy = bubble.y - cy;
      const norm = Math.hypot(vx, vy);
      const nx = vx / norm;
      const ny = vy / norm;
      const dot = bubble.dx * nx + bubble.dy * ny;
      bubble.dx = bubble.dx - 2 * dot * nx;
      bubble.dy = bubble.dy - 2 * dot * ny;
      // Küçük bir rasgelelik
      const angleNoise = (Math.random()-0.5) * 0.6;
      const speed = Math.hypot(bubble.dx, bubble.dy);
      const angle = Math.atan2(bubble.dy, bubble.dx) + angleNoise;
      bubble.dx = Math.cos(angle) * speed;
      bubble.dy = Math.sin(angle) * speed;
    }

    // Oyunu başlat
    startBtn.onclick = () => {
      startBtn.disabled = true;
      startBtn.textContent = "Oyun Başladı...";
      clearBubbles();
      running = true;

      // İlk baloncuğu merkezde başlat, rastgele bir yön
      const angle = Math.random() * Math.PI * 2;
      // %80 yavaş
      const speed = 3.4 * 0.2;
      const dx = Math.cos(angle) * speed;
      const dy = Math.sin(angle) * speed;
      const colorIndex = Math.floor(Math.random()*COLORS.length);
      const startBubble = createBubble(ARENA_RADIUS, ARENA_RADIUS, dx, dy, colorIndex);
      bubbles.push(startBubble);
      updateCounter();

      animate();

      gameTimeout = setTimeout(() => {
        running = false;
        cancelAnimationFrame(animationId);
        startBtn.disabled = false;
        startBtn.textContent = "Yeniden Başlat";
      }, GAME_DURATION);
    };

    // Animasyon döngüsü
    function animate() {
      let newBubbles = [];

      for (let b of bubbles) {
        b.x += b.dx;
        b.y += b.dy;

        let hit = false;
        if (isHittingCircleEdge(b)) {
          bounceOffCircle(b);
          hit = true;
        }

        // DOM güncelle
        b.el.style.left = (b.x - BUBBLE_RADIUS) + 'px';
        b.el.style.top = (b.y - BUBBLE_RADIUS) + 'px';

        if (hit) {
          // Çarpınca iki yeni baloncuk üret (her biri farklı rastgele yön ve renk)
          for (let i = 0; i < 2; i++) {
            const angle = Math.random() * Math.PI * 2;
            // %80 yavaş
            const speed = (2.6 + Math.random() * 2.8) * 0.2;
            const dx = Math.cos(angle) * speed;
            const dy = Math.sin(angle) * speed;
            // Kenara çok yakın olduğundan çemberin içine biraz it
            const norm = Math.hypot(b.x - ARENA_RADIUS, b.y - ARENA_RADIUS);
            const pullBackRatio = ((ARENA_RADIUS - BUBBLE_RADIUS - 2) / norm);
            const newX = ARENA_RADIUS + (b.x - ARENA_RADIUS) * pullBackRatio;
            const newY = ARENA_RADIUS + (b.y - ARENA_RADIUS) * pullBackRatio;
            const colorIndex = Math.floor(Math.random()*COLORS.length);
            const clone = createBubble(newX, newY, dx, dy, colorIndex);
            newBubbles.push(clone);
          }
          // Eskiyi sil (DOM)
          b.el.remove();
        } else {
          newBubbles.push(b);
        }
      }

      bubbles = newBubbles;
      updateCounter();

      if (bubbles.length > MAX_BUBBLES) {
        running = false;
        alert(Baloncuk limiti (${MAX_BUBBLES}) aşıldı! Oyun otomatik durdu.);
        cancelAnimationFrame(animationId);
        clearTimeout(gameTimeout);
        startBtn.disabled = false;
        startBtn.textContent = "Yeniden Başlat";
        return;
      }

      if (running) {
        animationId = requestAnimationFrame(animate);
      }
    }
  </script>
</body>
</html>
