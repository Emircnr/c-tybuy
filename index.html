<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>5 Karadelikli Arena - Sesli</title>
  <style>
    body {
      background: radial-gradient(ellipse at center, #232b41 70%, #10141c 100%);
      color: #232344;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0; padding: 0;
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
      justify-content: flex-start;
    }
    .title {
      margin-top: 34px;
      font-size: 2.3rem;
      color: #24243a;
      font-weight: 800;
      letter-spacing: 1.13px;
      text-align: center;
      user-select: none;
      text-shadow: 0 2px 18px #fff8, 0 10px 38px #bbeaff99;
    }
    #container {
      margin-top: 19px;
      background: linear-gradient(138deg,#f4f7fb 63%,#d3e3f3 100%);
      border-radius: 50px;
      box-shadow: 0 14px 90px #7bdbfc2a, 0 2px 18px #8fcdfa11;
      display: flex; flex-direction: column; align-items: center;
      padding: 38px 18px 28px 18px;
    }
    #canvas {
      display: block;
      background: radial-gradient(circle at 60% 60%, #e2eaf7 75%, #b7c5dd 100%);
      border-radius: 50%;
      box-shadow: 0 0 0 20px #e5f7ff11, 0 0 84px #c1eaff18 inset;
      margin: 0 auto;
      border: 14px solid #bde3ff;
    }
    #startBtn {
      margin-top: 22px;
      padding: 17px 48px;
      font-size: 1.18rem;
      border-radius: 17px;
      border: none;
      background: linear-gradient(90deg,#7be2ff 0%,#fff7 97%);
      color: #171c29;
      font-weight: bold;
      box-shadow: 0 4px 29px #96e7ff7d;
      cursor: pointer;
      transition: background .13s, box-shadow .13s;
      letter-spacing: 1.07px;
    }
    #startBtn:hover {
      background: linear-gradient(92deg,#1ec3ff 0%,#e8fafd 100%);
      box-shadow: 0 4px 40px #b8f8fff1;
    }
    #desc {
      font-size: 1.14rem;
      color: #38446c;
      text-align: center;
      margin-bottom: 17px;
      margin-top: 0;
      letter-spacing: .18px;
      font-weight: 500;
    }
    #counter {
      font-size: 1.09rem;
      font-weight: 600;
      color: #1488b8;
      margin-bottom: 13px;
      letter-spacing: .09px;
    }
  </style>
</head>
<body>
  <div class="title">
    5 Karadelikli Arena - SESLİ
  </div>
  <div id="container">
    <p id="desc">
      <b>Her karadelik farklı renkte parlak halo ile çevrili. Toplar patlayınca 3'e bölünür, efekt ve arka plan sesiyle!</b><br>
      Her top yutulduğunda büyüme 2 kat hızlı, toplam 500 top sınırı.
    </p>
    <div id="counter">Toplar: <span id="ballCount">0</span> / 500</div>
    <canvas id="canvas" width="1100" height="1100"></canvas>
    <button id="startBtn">Başlat</button>
    <!-- SESLER -->
    <audio id="bgMusic" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12fa874df2.mp3" loop preload="auto"></audio>
    <audio id="popSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_12618.mp3" preload="auto"></audio>
    <audio id="bhEat" src="https://cdn.pixabay.com/audio/2022/03/15/audio_11462.mp3" preload="auto"></audio>
  </div>
  <script>
    // Ayarlar
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const w = canvas.width, h = canvas.height;
    const ARENA = { x: w/2, y: h/2, r: 445 };
    const BH_COUNT = 5;
    const BH_AURAS = [
      "#48eaff", // cyan
      "#e86dff", // mor
      "#fff247", // sarı
      "#ffac40", // turuncu
      "#48ff93"  // yeşil
    ];
    const ANGLES = Array.from({length: BH_COUNT}, (_,i)=>Math.PI/2 + i*2*Math.PI/BH_COUNT);
    const BLACK_HOLE_INIT_R = 48;
    const NEON_MAIN_R = 35;
    const NEON_CHILD_R = 16;
    const MIN_BH_R = 28;
    const MAX_BALLS = 500;
    const FPS_LIMIT = 60;

    let blackholes = [];
    let balls = [], running = false, animationId = null, timerId = null, t = 0, lastFrame = 0;
    let enableSpawn = true;

    const BALL_COLORS = [
      "#1976d2", "#ec407a", "#00897b", "#f4511e", "#6d4c41", "#3949ab", "#00acc1", "#ffa000"
    ];

    function playSound(id, volume=0.28) {
      let el = document.getElementById(id);
      try {
        el.pause();
        el.currentTime = 0;
        el.volume = volume;
        el.play();
      } catch(e) {}
    }

    function neonColor(i) {
      return BALL_COLORS[i % BALL_COLORS.length];
    }

    function drawArena() {
      ctx.save();
      let grad = ctx.createRadialGradient(ARENA.x-ARENA.r*0.45, ARENA.y-ARENA.r*0.43, ARENA.r*0.33, ARENA.x, ARENA.y, ARENA.r);
      grad.addColorStop(0, "#fafdff");
      grad.addColorStop(0.39, "#d9e7f8");
      grad.addColorStop(0.72, "#c9d4e9");
      grad.addColorStop(1, "#9ec1da");
      ctx.beginPath();
      ctx.arc(ARENA.x, ARENA.y, ARENA.r, 0, Math.PI*2);
      ctx.fillStyle = grad;
      ctx.shadowColor = "#eaf8ff";
      ctx.shadowBlur = 38;
      ctx.fill();
      ctx.globalAlpha = 0.13;
      for(let i=1;i<=5;i++){
        ctx.beginPath();
        ctx.arc(ARENA.x, ARENA.y, ARENA.r*i/5, 0, Math.PI*2);
        ctx.strokeStyle = "#b5c9e8";
        ctx.lineWidth = 2;
        ctx.stroke();
      }
      ctx.globalAlpha = 1;
      ctx.lineWidth = 20;
      ctx.strokeStyle = "#98d0ff";
      ctx.beginPath();
      ctx.arc(ARENA.x, ARENA.y, ARENA.r, 0, Math.PI*2);
      ctx.stroke();
      ctx.restore();
    }

    function drawBlackHole(bh, auraColor, pulseT) {
      ctx.save();
      // Renkli parlak halo
      let grad = ctx.createRadialGradient(bh.x, bh.y, bh.r*1.02, bh.x, bh.y, bh.r*1.5);
      grad.addColorStop(0, "#fff0");
      grad.addColorStop(0.19, auraColor+"33");
      grad.addColorStop(0.5, auraColor+"99");
      grad.addColorStop(0.9, auraColor+"13");
      grad.addColorStop(1, "#fff0");
      ctx.beginPath();
      ctx.arc(bh.x, bh.y, bh.r*1.48, 0, Math.PI*2);
      ctx.globalAlpha = 0.31;
      ctx.fillStyle = grad;
      ctx.shadowColor = auraColor;
      ctx.shadowBlur = 32;
      ctx.fill();

      // Siyah çekirdek (karadelik)
      ctx.beginPath();
      ctx.arc(bh.x, bh.y, bh.r, 0, Math.PI*2);
      ctx.globalAlpha = 1;
      ctx.fillStyle = "#000";
      ctx.shadowColor = "#222";
      ctx.shadowBlur = 8;
      ctx.fill();

      // Yutulma animasyonu (shockwave)
      if (bh.growAnim > 0.07) {
        ctx.beginPath();
        ctx.arc(bh.x, bh.y, bh.r*1.13 + Math.sin(pulseT*13)*2*bh.growAnim, 0, Math.PI*2);
        ctx.strokeStyle = "#fff";
        ctx.globalAlpha = 0.11*bh.growAnim;
        ctx.lineWidth = 7*bh.growAnim;
        ctx.shadowBlur = 15*bh.growAnim;
        ctx.stroke();
        bh.growAnim *= 0.89;
      }
      ctx.restore();
    }

    function drawBalls(now) {
      for(let i=0;i<balls.length;i++) {
        let ball = balls[i];
        ctx.save();
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.r+6, 0, Math.PI*2);
        ctx.globalAlpha = 0.18 + 0.11*Math.sin(now/1010+ball.colorSeed*4.2);
        ctx.shadowColor = ball.color;
        ctx.shadowBlur = 14 + 7*Math.sin(now/600+ball.colorSeed*1.3);
        ctx.fillStyle = ball.color;
        ctx.fill();
        ctx.restore();

        ctx.save();
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
        ctx.globalAlpha = 0.97;
        ctx.fillStyle = ball.color;
        ctx.shadowColor = ball.color;
        ctx.shadowBlur = 6;
        ctx.fill();

        ctx.globalAlpha = 0.12;
        ctx.beginPath();
        ctx.arc(ball.x-ball.r/3, ball.y-ball.r/4, ball.r/3.7, 0, Math.PI*2);
        ctx.fillStyle = "#fff";
        ctx.fill();
        ctx.restore();

        if (ball.exploding > 0.07) {
          ctx.save();
          ctx.beginPath();
          ctx.arc(ball.x, ball.y, ball.r+ball.exploding*12, 0, Math.PI*2);
          ctx.strokeStyle = "#fff";
          ctx.globalAlpha = 0.09*ball.exploding;
          ctx.lineWidth = 5*ball.exploding;
          ctx.shadowColor = ball.color;
          ctx.shadowBlur = 8*ball.exploding;
          ctx.stroke();
          ctx.restore();
          ball.exploding *= 0.81;
        }
      }
    }

    function isInBlackHole(ball, bh) {
      let dx = ball.x - bh.x, dy = ball.y - bh.y;
      return Math.hypot(dx, dy) < bh.r - 2;
    }
    function reflectBall(ball) {
      let dx = ball.x - ARENA.x, dy = ball.y - ARENA.y;
      let dist = Math.hypot(dx, dy);
      if (dist >= ARENA.r - ball.r - 10) {
        let nx = dx / dist, ny = dy / dist;
        let dot = ball.vx * nx + ball.vy * ny;
        ball.vx -= 2 * dot * nx;
        ball.vy -= 2 * dot * ny;
        let speed = Math.hypot(ball.vx, ball.vy);
        let angle = Math.atan2(ball.vy, ball.vx) + (Math.random()-0.5)*0.13;
        ball.vx = Math.cos(angle)*speed*0.97;
        ball.vy = Math.sin(angle)*speed*0.97;
        let over = dist - (ARENA.r - ball.r - 10) + 1;
        ball.x -= nx*over;
        ball.y -= ny*over;
      }
    }

    function spawnBalls(ball, now) {
      if (!enableSpawn || balls.length >= MAX_BALLS) return;
      let angle0 = Math.random()*Math.PI*2;
      for(let k=0;k<3;k++) {
        let angle = angle0 + k*(2*Math.PI/3) + (Math.random()-0.5)*0.10;
        let speed = (1.17 + Math.random()*1.12) * 1.4;
        let r = NEON_CHILD_R * (0.91 + Math.random()*0.21);
        let colorSeed = Math.random();
        let color = neonColor(Math.floor(Math.random()*60));
        balls.push({
          x: ball.x, y: ball.y,
          vx: Math.cos(angle)*speed,
          vy: Math.sin(angle)*speed,
          r: r,
          color,
          colorSeed,
          exploded: false,
          exploding: 0,
          explodeAt: (performance.now()/1000) + 3 + Math.random()*3,
          createdAt: performance.now()/1000,
          growStart: ball.r,
          isMain: false
        });
      }
      playSound('popSound', 0.17);
    }

    function updateCounter() {
      document.getElementById('ballCount').textContent = balls.length;
    }

    function animate(now) {
      if(now - lastFrame < 1000/FPS_LIMIT) {
        animationId = requestAnimationFrame(animate);
        return;
      }
      lastFrame = now;
      t = now/1000;

      enableSpawn = balls.length < MAX_BALLS;

      for(let i=balls.length-1;i>=0;i--) {
        let ball = balls[i];
        if (!ball.exploded && t > ball.explodeAt) {
          ball.exploded = true;
          ball.exploding = 1;
          if(enableSpawn) spawnBalls(ball, now);
          balls.splice(i,1);
          continue;
        }
        if (!ball.exploded) {
          let duration = ball.explodeAt - ball.createdAt;
          let maxGrow = (ball.isMain ? NEON_MAIN_R*1.45 : NEON_CHILD_R*1.31);
          let growth = (maxGrow - ball.r) / (duration * 60);
          if(ball.r < maxGrow) ball.r += Math.max(growth, 0.05);
          ball.x += ball.vx;
          ball.y += ball.vy;
          ball.vx *= 0.997;
          ball.vy *= 0.997;
          reflectBall(ball);

          let eaten = false;
          for(let b=0; b<BH_COUNT; b++){
            if(isInBlackHole(ball, blackholes[b])){
              let delta = ball.r*0.020*2; // 2 kat hızlı büyüme
              blackholes[b].r += delta;
              blackholes[b].growAnim = 1.11;
              for(let j=0;j<BH_COUNT;j++) {
                if(j!==b) blackholes[j].r = Math.max(MIN_BH_R, blackholes[j].r - delta/(BH_COUNT-1));
              }
              balls.splice(i,1);
              eaten = true;
              playSound('bhEat', 0.25);
              break;
            }
          }
          if(eaten) continue;
        }
      }
      ctx.clearRect(0,0,w,h);
      drawArena();
      for(let i=0;i<BH_COUNT;i++) drawBlackHole(blackholes[i], BH_AURAS[i], t+0.33*i);
      drawBalls(now);
      updateCounter();

      if(running) animationId = requestAnimationFrame(animate);
      else document.getElementById('startBtn').textContent = "Tekrar Başlat";
    }

    document.getElementById('startBtn').onclick = function() {
      if(running) return;
      running = true;
      t = 0;
      balls = [];
      blackholes = [];
      for(let i=0;i<BH_COUNT;i++) {
        let angle = ANGLES[i];
        blackholes.push({
          x: ARENA.x + ARENA.r * 0.74 * Math.cos(angle),
          y: ARENA.y - ARENA.r * 0.74 * Math.sin(angle),
          r: BLACK_HOLE_INIT_R,
          growAnim: 0,
        });
      }
      let angle = Math.random()*Math.PI*2;
      let speed = (1.2+Math.random()*1.2) * 1.4;
      balls.push({
        x: ARENA.x + Math.cos(angle)*180,
        y: ARENA.y + Math.sin(angle)*180,
        vx: Math.cos(angle+Math.PI/2)*speed,
        vy: Math.sin(angle+Math.PI/2)*speed,
        r: NEON_MAIN_R,
        color: neonColor(Math.floor(Math.random()*60)),
        colorSeed: Math.random(),
        isMain: true,
        exploded: false,
        exploding: 0,
        explodeAt: (performance.now()/1000) + 3,
        createdAt: performance.now()/1000,
        growStart: NEON_MAIN_R
      });
      this.textContent = "Devam Ediyor...";
      updateCounter();
      animate(0);

      // Müzik başlat (her zaman buton tıklamasında aktifleşir)
      let bg = document.getElementById('bgMusic');
      bg.volume = 0.13;
      bg.currentTime = 0;
      bg.play();

      if (timerId) clearTimeout(timerId);
      timerId = setTimeout(()=>{
        running = false;
        balls = [];
        updateCounter();
        document.getElementById('startBtn').textContent = "Tekrar Başlat";
        document.getElementById('bgMusic').pause();
      }, 100000);
    };
  </script>
</body>
</html>
